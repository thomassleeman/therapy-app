# Supabase
NEXT_PUBLIC_SUPABASE_URL=<supabase project url>
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY=<supabase anon key>
SUPABASE_SERVICE_ROLE_KEY=<supabase service role key>

# AI Gateway (required for non-Vercel local dev; auto-wired on Vercel)
AI_GATEWAY_API_KEY=<vercel AI gateway key>

# OpenAI (for text-embedding-3-small used in RAG)
OPENAI_API_KEY=<openai api key>

# Redis (optional — enables resumable streams)
# REDIS_URL=<redis connection url>

# ── Multi-query retrieval (optional, reduces vocabulary mismatch failures) ────
# When enabled, an LLM generates 3 clinical reformulations of each search query.
# All variants are searched in parallel and merged via RRF before reranking.
# Adds ~$0.0003 per search invocation (one gpt-4o-mini call) + 3 embedding calls.
ENABLE_QUERY_REFORMULATION=true

# ── Cohere reranking (optional, high-impact RAG quality improvement) ──────────
# Cross-encoder reranking improves retrieval precision significantly.
# Both vars must be set for reranking to activate.
COHERE_API_KEY=<cohere api key>
ENABLE_RERANKING=true

# ── Dev-only RAG quality logging ─────────────────────────────────────────────
# Set to "true" to enable per-turn JSONL logging for RAG quality analysis.
# Logs are written to {DEV_LOG_DIR}/sessions/ and NEVER sent to the client.
# User IDs are hashed with SHA-256 before storage.
# The logs/ directory is in .gitignore.
DEV_LOGGING=true

# Directory for log files. Defaults to <project root>/logs if not set.
# DEV_LOG_DIR=./logs

# Set to "true" to also print a condensed summary to the console on each turn.
# DEV_LOG_CONSOLE=true

# ── Post-generation faithfulness verification ─────────────────────────────────
# When enabled, each grounded response is evaluated asynchronously against the
# retrieved KB chunks using gpt-4o-mini. Results are saved to the
# faithfulness_checks table. Does NOT block the response stream.
# Requires OPENAI_API_KEY to be set.
# ENABLE_FAITHFULNESS_CHECK=true
